[General]
# Быстрая настройка Shadowrocket:
# Включите английский язык Настройки → Language → English
# Идем в Home и нажимаем «+» или Add Server
# Добавьте любой подходящий конфиг: Config → «+» или Download from URL
# В настройках выберите способ проверки Settings → Advanced → Connect
# Нажмите Connectivity Test и если сервер доступен, то нажмите на ползунок
# При первом запуске появится запрос на установку VPN-конфигурации — нажмите «OK» и «Разрешить».

# Включение HTTPS-декрипции:
# В Config → ⓘ, → HTTPS Decryption → Certificate → Generate A New CA Certificate → Install CA Certificate to System
# В настройках системы — скачанные профили — «Установить».
# В настройках системы — «Основные» — «О устройстве» — «Настройки доверия сертификатов» — включить сертификат Shadowrocket.
# Для синхронизации между устройствами, если конфиг содержит ключ, рекомендуется сразу установить сертификат, а не генерировать новый.

# Системные сетевые вызовы (например, push-уведомления, iOS системные сервисы) будут обходить прокси.
# Если выставить false, легитимный системный трафик может пойти через прокси, 
# что приведёт к задержкам или некорректной работе системных функций.
bypass-system = true

# Отключение поддержки IPv6. В системах и сетях, где IPv6 стабильный и 
# поддерживается, можно включить (true), иначе IPv4 останется основным
ipv6 = false

# Отдавать приоритет разрешению DNS-записей AAAA (IPv6) над A (IPv4). 
# Важно только если ipv6 включён. Полезно на сетях с сильной поддержкой IPv6, иначе оставлять false.
prefer-ipv6 = false

# Если true, при DNS-запросах возвращаются приватные IP адреса (например, из диапазона 192.168.x.x). 
# При false Shadowrocket будет считать домен "захваченным" и принудительно отправит трафик через прокси, что может нарушать локальную сеть. Обычно лучше оставлять true.
private-ip-answer = true

# Управляет тем, будет ли DNS разрешение происходить напрямую через системный DNS, а не через прокси или настроенный DoH/DoT. 
# Если точно нужен перехват DNS — оставлять false; для обхода по системному DNS — true.
dns-direct-system = false

# Если DNS-запросы через основной DNS (например DoH) неудачны, будет ли пробоваться системный DNS. 
# При false — отказ DNS через fallback. Можно включить, чтобы повысить стабильность разрешения.
dns-fallback-system = false

# Если прямое разрешение DNS не работает, использовать прокси-сервер для DNS-запросов
dns-direct-fallback-proxy = true

# Переопределение DNS. Переопределите системный DNS по умолчанию, 
# используя обычный DNS или зашифрованный DNS (например, doh, doq, dot и т. д.). 
# Некоторые DNS через https поддерживают http3, поэтому попробуйте выполнить запрос и переключиться 
# на http3, если он поддерживается. Вы можете добавить #no-h3 после ссылки doh, чтобы закрыть ее. 
# Используются Adguard DNS с блокировкой рекламы 
dns-server = https://cloudflare-dns.com/dns-query, https://dns.google/dns-query

# Альтернативный DNS. Возврат к резервному DNS при сбое разрешения перезаписанного DNS. 
# Если вам нужно указать несколько DNS, их можно разделить запятыми. system означает возврат к системному DNS. 
# Вы можете выбрать альтернативный DOH/DOT — https://github.com/curl/curl/wiki/DNS-over-HTTPS
# fallback-dns-server = https://dns.adguard-dns.com/dns-query, https://cloudflare-dns.com/dns-query, https://freedns.controld.com/p3
fallback-dns-server = system

# Перезапись DNS. Некоторые устройства или программное обеспечение всегда 
# используют жестко запрограммированные DNS-серверы, например Netflix отправляет 
# запросы через Google DNS (8.8.8.8 или 8.8.4.4). Вы можете использовать эту опцию для перехвата запросов.
hijack-dns = :53

# Делает исключения для указанных IP и доменов — локальный трафик не идёт через прокси, что предотвращает конфликты с локальными сетями и службами (например, Bonjour, Captive Portal).
skip-proxy = 192.168.0.0/16,10.0.0.0/8,172.16.0.0/12,localhost,*.local,captive.apple.com

# Исключения маршрутов для TUN-интерфейса, так как Shadowrocket TUN поддерживает только TCP. 
# Это важно для правильного маршрутизирования UDP и специальных адресов.
tun-excluded-routes = 10.0.0.0/8,100.64.0.0/10,127.0.0.0/8,169.254.0.0/16,172.16.0.0/12,192.0.0.0/24,192.0.2.0/24,192.88.99.0/24,192.168.0.0/16,198.51.100.0/24,203.0.113.0/24,224.0.0.0/4,255.255.255.255/32,239.255.255.250/32

# TUN содержит маршруты. По умолчанию интерфейс Shadowrocket объявляет себя маршрутом 
# по умолчанию, но из-за меньшей маршрутизации интерфейса Wi-Fi некоторый трафик может 
# не проходить через интерфейс Shadowrocket. Используйте эту опцию, чтобы добавить меньшую таблицу маршрутизации.
tun-included-routes = 

# Позволяет SR возвращать настоящий IP вместо fake-IP для перечисленных доменов. 
# Это важно для служб, где нужно "реальное" соединение без проксирования (например, NTP, Cloudflare client). 
# Позволяет сократить проблемы с задержками, ошибками соединения и энергопотреблением.
always-real-ip=*

# Включает автоматический ответ на ping (ICMP Echo Request) от имени TUN-интерфейса. 
# Удобно для сетевой диагностики, но может приводить к созданию fake-IP маппинга, что увеличивает расход ресурсов и может в итоге разряжать аккумулятор. 
# Если цель — минимизация fake-IP и энергозатрат, ставить false.
icmp-auto-reply = false

# Управляет, активна ли политика REJECT для URL-перезаписи вне режима конфигурации. 
# При true REJECT работает постоянно, что может «жёстко» блокировать трафик. 
always-reject-url-rewrite = false

# Как поступать с UDP-трафиком, если политика узла не поддерживает UDP-перенаправление: отбрасывать (REJECT) или направлять напрямую (DIRECT). 
# Выбор зависит от желаемого поведения и возможности узла.
udp-policy-not-supported-behaviour = REJECT

# Позволяет включать внешние конфигурационные файлы. Удобно для больших конфигов, переиспользования настроек.
# Если параметры или правила в подключаемом файле пересекаются с основным, приоритет обычно имеет основной файл (где прописано include), но детали могут зависеть от реализации.
# include = sr_ru_extended.conf

# URL-адрес обновления файла конфигурации
update-url = https://github.com/Gambino36/rule-sets/raw/master/Shadowrocket/gambino-sr-rules.conf

# Выбираем наиболее быстрый сервера для прокси
# [Proxy Group]
# AUTO = url-test,interval=600,timeout=5,url=https://cp.cloudflare.com/generate_204,policy-regex-filter=*

# Опционально. Добавьте эти адреса в настройках программы Settings → GeoLite2 Database
# Если у вас нет аккаунта на Maxmind и вы испольузуете финальное правило Proxy или Auto
# country: https://git.io/GeoLite2-Country.mmdb
# asn: https://git.io/GeoLite2-ASN.mmdb

# Выборочные правила маршрутизации
[Rule]
### Apple
### RULE-SET,https://github.com/blackmatrix7/ios_rule_script/raw/master/rule/Clash/Apple/Apple_Classical.yaml,DIRECT
# WhatsApp/Telegram/FaceTime
RULE-SET,https://github.com/Gambino36/rule-sets/raw/master/Shadowrocket/gambino-voice_ports.yaml,PROXY
# Telegram
RULE-SET,https://github.com/blackmatrix7/ios_rule_script/raw/master/rule/Clash/Telegram/Telegram.list,PROXY
# Whatsapp
RULE-SET,https://github.com/blackmatrix7/ios_rule_script/raw/master/rule/Clash/Whatsapp/Whatsapp.list,PROXY
RULE-SET,https://github.com/HybridNetworks/whatsapp-cidr/raw/main/WhatsApp/whatsapp_cidr_ipv4.list,PROXY,no-resolve
# category-ai
RULE-SET,https://github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/classical/category-ai-!cn.list,PROXY
# Gemini
RULE-SET,https://github.com/blackmatrix7/ios_rule_script/raw/master/rule/Clash/Gemini/Gemini.list,PROXY
# Spotify
RULE-SET,https://github.com/blackmatrix7/ios_rule_script/raw/master/rule/Clash/Spotify/Spotify.list,PROXY
# gambino-proxy
RULE-SET,https://github.com/Gambino36/rule-sets/raw/master/Clash/gambino-proxy.yaml,PROXY
### gambino-yt-proxy
### RULE-SET,https://github.com/Gambino36/rule-sets/raw/master/Shadowrocket/gambino-yt-proxy.yaml,PROXY
# Youtube
RULE-SET,https://github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/classical/youtube.list,PROXY
# Twitch
RULE-SET,https://github.com/blackmatrix7/ios_rule_script/raw/master/rule/Clash/Twitch/Twitch.list,PROXY
# GitHub
RULE-SET,https://github.com/blackmatrix7/ios_rule_script/raw/master/rule/Clash/GitHub/GitHub.list,PROXY
# TikTok
RULE-SET,https://github.com/blackmatrix7/ios_rule_script/raw/master/rule/Clash/TikTok/TikTok.list,PROXY
# Remote-Control
RULE-SET,https://github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/classical/category-remote-control.list,PROXY
### Google
### RULE-SET,https://github.com/blackmatrix7/ios_rule_script/raw/master/rule/Clash/Google/Google.yaml,DIRECT
# ITDog inside-clashx
RULE-SET,https://github.com/itdoginfo/allow-domains/raw/main/Russia/inside-clashx.lst,PROXY
# IPs сообщества «Про Shadowrocket на русском»
RULE-SET,https://github.com/misha-tgshv/shadowrocket-configuration-file/raw/main/rules/domain_ips.list,PROXY,no-resolve
### RU-Bundle
### RULE-SET,https://github.com/legiz-ru/mihomo-rule-sets/raw/main/ru-bundle/rule.yaml,PROXY
### category-ru
### RULE-SET,https://github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/classical/category-ru.yaml,DIRECT
# Re-filter IPs
RULE-SET,https://github.com/misha-tgshv/shadowrocket-configuration-file/raw/main/rules/ips_antifilter.list,PROXY,no-resolve
###RULE-SET,https://github.com/1andrevich/Re-filter-lists/raw/main/ipsum.lst,PROXY,no-resolve
# Список доменов Discord
RULE-SET,https://github.com/blackmatrix7/ios_rule_script/raw/master/rule/Clash/Discord/Discord.list,PROXY
### Список портов Discord
### RULE-SET,https://github.com/helmiau/clashrules/raw/main/shadowrocket/Game_Discord_Ports.list,PROXY
# Финальное правило маршрутизации
FINAL,DIRECT
